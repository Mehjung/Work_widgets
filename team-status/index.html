<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Teamstatus Widget</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',sans-serif;background:transparent;overflow-x:hidden}
.w{padding:16px;width:100%;max-width:360px;margin:0 auto}
.hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
.hdr-t{font-size:14px;font-weight:700;color:#1a1a2e}
.stats{display:flex;gap:12px}
.stat{display:flex;align-items:center;gap:4px;font-size:11px;color:#888}
.stat .dot{width:8px;height:8px;border-radius:50%}
.dot.on{background:#16a34a}.dot.off{background:#f59e0b}.dot.out{background:#ec0016}
.list{display:flex;flex-direction:column;gap:6px}
.row{display:flex;align-items:center;gap:10px;padding:8px 10px;border-radius:8px;background:rgba(0,0,0,.02)}
.row:hover{background:rgba(0,0,0,.04)}
.av{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:#fff;flex-shrink:0;position:relative}
.av .ind{position:absolute;bottom:-1px;right:-1px;width:10px;height:10px;border-radius:50%;border:2px solid #fff}
.name{font-size:13px;font-weight:600;color:#1a1a2e;flex:1}
.role{font-size:11px;color:#888}
.badge{padding:2px 8px;border-radius:10px;font-size:10px;font-weight:600}
.badge.anwesend{background:rgba(22,163,74,.1);color:#16a34a}
.badge.urlaub{background:rgba(245,158,11,.1);color:#f59e0b}
.badge.krank{background:rgba(236,0,22,.1);color:#ec0016}
.badge.extern{background:rgba(14,165,233,.1);color:#0ea5e9}
body.dark{background:#1a1a2e}body.dark .hdr-t{color:#fff}body.dark .name{color:#fff}body.dark .role{color:rgba(255,255,255,.4)}body.dark .row{background:rgba(255,255,255,.04)}body.dark .row:hover{background:rgba(255,255,255,.07)}body.dark .av .ind{border-color:#1a1a2e}body.dark .stat{color:rgba(255,255,255,.5)}
.compact .row{padding:5px 8px;gap:8px}.compact .av{width:26px;height:26px;font-size:10px}.compact .name{font-size:12px}
</style>
</head>
<body>
<div class="w">
    <div class="hdr"><div class="hdr-t" id="title">Teamstatus</div><div class="stats" id="stats"></div></div>
    <div class="list" id="list"></div>
</div>
<script>
const P=new URLSearchParams(location.search);
if(P.get('theme')==='dark')document.body.classList.add('dark');
if(P.get('compact')==='true')document.body.classList.add('compact');
document.getElementById('title').textContent=P.get('title')||'Teamstatus';

// Members format: Name,Rolle,Status,Farbe;;Name2,...
// Status: anwesend, urlaub, krank, extern
const raw=P.get('members')||'Anna M.,Teamleitung,anwesend,#ec0016;;Thomas K.,Zeitwirtschaft,anwesend,#0078d4;;Sarah L.,Entgelt,anwesend,#16a34a;;Peter W.,Entgelt,urlaub,#8764b8;;Maria B.,Zeitwirtschaft,anwesend,#f59e0b;;Klaus D.,Reisekosten,anwesend,#0ea5e9;;Julia F.,EAU,krank,#ec0016;;Stefan H.,Bescheinigungen,anwesend,#107c10;;Lisa R.,Entgelt,anwesend,#d29922;;Markus T.,Zeitwirtschaft,extern,#0078d4';

const members=raw.split(';;').map(r=>{
    const[name,role,status,color]=r.split(',');
    return{name:name.trim(),role:(role||'').trim(),status:(status||'anwesend').trim(),color:(color||'#888').trim()};
});

const list=document.getElementById('list');
const counts={anwesend:0,urlaub:0,krank:0,extern:0};

members.forEach(m=>{
    counts[m.status]=(counts[m.status]||0)+1;
    const initials=m.name.split(' ').map(n=>n[0]).join('').substring(0,2);
    const dotClass=m.status==='anwesend'?'on':m.status==='urlaub'?'off':'out';
    list.innerHTML+=`<div class="row">
        <div class="av" style="background:${m.color}"><span>${initials}</span><div class="ind dot ${dotClass}"></div></div>
        <div style="flex:1"><div class="name">${m.name}</div><div class="role">${m.role}</div></div>
        <div class="badge ${m.status}">${m.status.charAt(0).toUpperCase()+m.status.slice(1)}</div>
    </div>`;
});

const statsEl=document.getElementById('stats');
if(counts.anwesend)statsEl.innerHTML+=`<div class="stat"><div class="dot on"></div>${counts.anwesend}</div>`;
if(counts.urlaub)statsEl.innerHTML+=`<div class="stat"><div class="dot off"></div>${counts.urlaub}</div>`;
if(counts.krank)statsEl.innerHTML+=`<div class="stat"><div class="dot out"></div>${counts.krank}</div>`;
if(counts.extern)statsEl.innerHTML+=`<div class="stat"><div class="dot" style="background:#0ea5e9"></div>${counts.extern}</div>`;
</script>
</body>
</html>
