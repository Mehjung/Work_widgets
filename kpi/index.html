<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KPI Widget</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',sans-serif;display:flex;justify-content:center;align-items:center;min-height:100vh;background:transparent;overflow:hidden}
.w{text-align:center;padding:20px;width:100%}
.ring{position:relative;width:120px;height:120px;margin:0 auto 16px}
svg{width:120px;height:120px}
.rbg,.rfg{fill:none;stroke-width:8}
.rbg{stroke:#f0f0f0}.rfg{stroke:#ec0016;stroke-linecap:round;transform:rotate(-90deg);transform-origin:center;transition:stroke-dashoffset 1.5s ease}
.rv{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:28px;font-weight:800;color:#1a1a2e}
.rv .u{font-size:14px;font-weight:400;color:#888}
.bw{margin:0 auto 16px;max-width:280px}.blr{display:flex;justify-content:space-between;margin-bottom:6px}
.bc{font-size:24px;font-weight:800;color:#1a1a2e}.bt{font-size:12px;color:#888;align-self:flex-end}
.btr{height:10px;background:#f0f0f0;border-radius:5px;overflow:hidden}
.bf{height:100%;border-radius:5px;background:linear-gradient(90deg,#ec0016,#ff6b6b);transition:width 1.5s ease}
.ti{font-size:12px;font-weight:600;color:#888;text-transform:uppercase;letter-spacing:1.5px;margin-bottom:4px}
.si{font-size:11px;color:#aaa;margin-top:8px}
.tr{display:inline-flex;align-items:center;gap:4px;font-size:12px;font-weight:600;margin-top:6px;padding:2px 10px;border-radius:12px}
.tr.up{background:rgba(22,163,74,.1);color:#16a34a}.tr.dn{background:rgba(236,0,22,.1);color:#ec0016}.tr.ne{background:rgba(0,0,0,.05);color:#888}
.hid{display:none}
body.dark{background:#1a1a2e}body.dark .ti{color:rgba(255,255,255,.5)}body.dark .rv{color:#fff}body.dark .rbg{stroke:rgba(255,255,255,.1)}body.dark .bc{color:#fff}body.dark .btr{background:rgba(255,255,255,.1)}body.dark .si{color:rgba(255,255,255,.4)}
</style>
</head>
<body>
<div class="w">
    <div class="ti" id="ti">KPI</div>
    <div class="ring" id="rw"><svg><circle class="rbg" cx="60" cy="60" r="52"/><circle class="rfg" id="rf" cx="60" cy="60" r="52"/></svg><div class="rv" id="rv"></div></div>
    <div class="bw hid" id="bw"><div class="blr"><div class="bc" id="bc"></div><div class="bt" id="btx"></div></div><div class="btr"><div class="bf" id="bf"></div></div></div>
    <div class="tr" id="tr"></div>
    <div class="si" id="si"></div>
</div>
<script>
const P=new URLSearchParams(location.search);
const val=parseFloat(P.get('value')||'75'),tgt=parseFloat(P.get('target')||'100'),unit=P.get('unit')||'';
const mode=P.get('mode')||'ring',color=P.get('color')||'#ec0016',theme=P.get('theme')||'light';
const trend=P.get('trend')||'',anim=P.get('animate')!=='false';
if(theme==='dark')document.body.classList.add('dark');
document.getElementById('ti').textContent=P.get('title')||'KPI';
document.getElementById('si').textContent=P.get('subtitle')||'';
const pct=Math.min(100,Math.max(0,(val/tgt)*100));
if(mode==='bar'){
    document.getElementById('rw').classList.add('hid');document.getElementById('bw').classList.remove('hid');
    document.getElementById('bc').textContent=val+(unit?' '+unit:'');
    document.getElementById('btx').textContent='Ziel: '+tgt+(unit?' '+unit:'');
    setTimeout(()=>{const bf=document.getElementById('bf');bf.style.width=pct+'%';bf.style.background=`linear-gradient(90deg,${color},${color}88)`},100);
}else{
    document.getElementById('bw').classList.add('hid');
    const C=2*Math.PI*52,r=document.getElementById('rf');
    r.style.stroke=color;r.style.strokeDasharray=C;r.style.strokeDashoffset=C;
    setTimeout(()=>r.style.strokeDashoffset=C*(1-pct/100),100);
    if(anim){const el=document.getElementById('rv'),dur=1500,st=performance.now(),isF=val%1!==0;
    !function tick(now){const p=Math.min((now-st)/dur,1),e=1-Math.pow(1-p,3),c=e*val;el.innerHTML=(isF?c.toFixed(1):Math.round(c))+`<span class="u">${unit}</span>`;if(p<1)requestAnimationFrame(tick)}(performance.now())}
    else document.getElementById('rv').innerHTML=val+`<span class="u">${unit}</span>`;
}
if(trend){const e=document.getElementById('tr'),up=trend.startsWith('+'),dn=trend.startsWith('-');e.className='tr '+(up?'up':dn?'dn':'ne');e.textContent=(up?'▲ ':dn?'▼ ':'')+trend}
else document.getElementById('tr').style.display='none';
</script>
</body>
</html>
