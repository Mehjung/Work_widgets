<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Countdown Widget</title>
<style>
:root{--font:'Segoe UI',system-ui,-apple-system,sans-serif;--red:#ec0016;--bg:#fff;--text:#1b1f24;--text2:#4b5563;--text3:#9ca3af;--border:#e5e7eb}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:var(--font);color:var(--text);background:transparent;display:flex;align-items:center;justify-content:center;min-height:100vh;padding:16px;-webkit-font-smoothing:antialiased}
.cd{text-align:center;width:100%;max-width:480px}
.cd-title{font-size:13px;font-weight:600;color:var(--text2);text-transform:uppercase;letter-spacing:1px;margin-bottom:16px}
.cd-blocks{display:flex;justify-content:center;gap:12px;margin-bottom:16px}
.cd-block{min-width:64px}
.cd-num{font-size:36px;font-weight:800;letter-spacing:-1px;color:var(--text);line-height:1}
.cd-label{font-size:10px;font-weight:500;color:var(--text3);text-transform:uppercase;letter-spacing:1px;margin-top:4px}
.cd-bar-wrap{height:4px;background:var(--border);border-radius:2px;overflow:hidden}
.cd-bar{height:100%;background:var(--red);border-radius:2px;transition:width 1s ease}
.cd-target{font-size:11px;color:var(--text3);margin-top:10px}
.cd-done{font-size:22px;font-weight:700;color:var(--red);padding:20px}

.compact .cd-blocks{gap:8px;margin-bottom:10px}
.compact .cd-num{font-size:24px}
.compact .cd-title{font-size:11px;margin-bottom:10px}

body.dark{--bg:#1a1a2e;--text:#f0f0f0;--text2:rgba(255,255,255,.65);--text3:rgba(255,255,255,.3);--border:rgba(255,255,255,.1);background:#1a1a2e}
</style>
</head>
<body>
<div class="cd" id="cd"></div>
<script>
const P=new URLSearchParams(location.search);
if(P.get('theme')==='dark') document.body.classList.add('dark');
if(P.get('compact')==='true') document.querySelector('.cd').classList.add('compact');

const title=P.get('title')||'Countdown';
const targetStr=P.get('target')||'2026-02-28T23:59';
const doneMsg=P.get('done')||'Abgeschlossen';
const target=new Date(targetStr);

function pad(n){return String(n).padStart(2,'0')}

function formatDate(d){
    const days=['So','Mo','Di','Mi','Do','Fr','Sa'];
    const months=['Jan','Feb','Mär','Apr','Mai','Jun','Jul','Aug','Sep','Okt','Nov','Dez'];
    return `${days[d.getDay()]}, ${d.getDate()}. ${months[d.getMonth()]} ${d.getFullYear()} · ${pad(d.getHours())}:${pad(d.getMinutes())}`;
}

function tick(){
    const now=new Date();
    const diff=target-now;

    if(diff<=0){
        document.getElementById('cd').innerHTML=`<div class="cd-done">${doneMsg}</div>`;
        return;
    }

    const d=Math.floor(diff/864e5);
    const h=Math.floor((diff%864e5)/36e5);
    const m=Math.floor((diff%36e5)/6e4);
    const s=Math.floor((diff%6e4)/1e3);

    // Progress: from when page loaded to target
    const totalFromNow=target-new Date(now.getFullYear(),now.getMonth(),now.getDate());
    const elapsed=totalFromNow-diff;
    const pct=Math.min(100,Math.max(0,(elapsed/totalFromNow)*100));

    document.getElementById('cd').innerHTML=`
        <div class="cd-title">${title}</div>
        <div class="cd-blocks">
            <div class="cd-block"><div class="cd-num">${d}</div><div class="cd-label">Tage</div></div>
            <div class="cd-block"><div class="cd-num">${pad(h)}</div><div class="cd-label">Std</div></div>
            <div class="cd-block"><div class="cd-num">${pad(m)}</div><div class="cd-label">Min</div></div>
            <div class="cd-block"><div class="cd-num">${pad(s)}</div><div class="cd-label">Sek</div></div>
        </div>
        <div class="cd-bar-wrap"><div class="cd-bar" style="width:${pct.toFixed(1)}%"></div></div>
        <div class="cd-target">${formatDate(target)}</div>
    `;
}

tick();
setInterval(tick,1000);
</script>
</body>
</html>
